#!/usr/bin/env python3

import glob
import os
import sys

import cvelib.cve
from cvelib.common import (
    getConfigCveDataPath,
    getConfigCompatUbuntu,
    warn,
)


def main():
    path = getConfigCveDataPath()
    compatUbuntu = getConfigCompatUbuntu()

    # TODO: make configurable
    active = os.path.join(path, "active")
    retired = os.path.join(path, "retired")
    ignored = os.path.join(path, "ignored")
    for f in (
        glob.glob(active + "/CVE*")
        + glob.glob(retired + "/CVE-*")
        + glob.glob(ignored + "/CVE-*")
    ):
        try:
            cvelib.cve.CVE(fn=f, compatUbuntu=compatUbuntu)
        except Exception as e:
            tmp = os.path.realpath(f).split('/')
            warn("%s: %s" % (tmp[-2] + "/" + tmp[-1], str(e)))


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("Aborted.")
        sys.exit(1)
